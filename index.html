<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Moon Jumper</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --ground-color: #3a8040;
            --sky-color-1: #87CEEB;
            --sky-color-2: #1a237e;
            --space-color: #0a0a2a;
            --platform-color-1: #8D6E63;
            --platform-color-2: #78909C;
            --platform-color-3: #E0E0E0;
            --cloud-color: rgba(255, 255, 255, 0.8);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            overflow: hidden;
            background-color: var(--sky-color-1);
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Background Layers */
        .bg-layer {
            position: absolute;
            width: 100%;
            height: 300%;
            top: 0;
            left: 0;
            transition: background-color 4s;
        }
        
        #sky-bg {
            background: linear-gradient(to top, var(--sky-color-1) 0%, var(--sky-color-2) 60%, var(--space-color) 85%);
            z-index: 1;
        }
        
        /* Sun and Moon */
        #sun {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFF176 20%, #FFD54F 50%, #FFB300 100%);
            border-radius: 50%;
            z-index: 2;
            box-shadow: 0 0 30px #FFD54F;
            top: 50px;
            right: 50px;
            transition: all 2s;
        }
        
        #moon {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ECEFF1 30%, #CFD8DC 70%, #B0BEC5 100%);
            border-radius: 50%;
            z-index: 2;
            box-shadow: 0 0 20px #CFD8DC;
            top: -120px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* Clouds */
        .cloud {
            position: absolute;
            z-index: 3;
            border-radius: 50%;
            background-color: var(--cloud-color);
            opacity: 0.9;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        /* Stars */
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            z-index: 2;
            opacity: 0;
            transition: opacity 2s;
            box-shadow: 0 0 2px white;
        }
        
        /* Ground */
        #ground {
            position: absolute;
            width: 100%;
            height: 100px;
            bottom: 0;
            background: linear-gradient(to bottom, var(--ground-color), #2d6a31);
            z-index: 4;
        }
        
        /* Buildings */
        .building {
            position: absolute;
            bottom: 100px;
            z-index: 3;
            background: linear-gradient(to bottom, #546E7A, #37474F);
            border-radius: 2px 2px 0 0;
        }
        
        /* Trees */
        .tree {
            position: absolute;
            bottom: 100px;
            z-index: 3;
        }
        
        .tree-trunk {
            width: 10px;
            height: 30px;
            background-color: #5D4037;
            margin: 0 auto;
        }
        
        .tree-top {
            width: 40px;
            height: 60px;
            background-color: #2E7D32;
            border-radius: 50% 50% 5% 5%;
            margin: -5px auto 0;
        }
        
        /* Platforms */
        .platform {
            position: absolute;
            height: 15px;
            z-index: 5;
            border-radius: 4px;
            background-color: var(--platform-color-1);
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
            transition: background-color 0.5s;
        }
        
        /* Special platforms */
        .platform.moving {
            animation: movePlatform 5s linear infinite alternate;
        }
        
        .platform.breakable {
            background-color: #FFAB91;
        }
        
        .platform.bouncy {
            background-color: #AED581;
        }
        
        /* Power-ups */
        .power-up {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            z-index: 5;
            animation: float 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .jetpack {
            background: radial-gradient(circle, #FFD600 30%, #FF9800 100%);
        }
        
        .shield {
            background: radial-gradient(circle, #90CAF9 30%, #2196F3 100%);
        }
        
        .coin {
            background: radial-gradient(circle, #FFF59D 30%, #FFD600 100%);
            width: 20px;
            height: 20px;
        }
        
        /* Player */
        #player {
            position: absolute;
            width: 50px;
            height: 50px;
            z-index: 10;
            transform: translateX(-50%);
            transition: transform 0.1s;
        }
        
        /* UI Elements */
        #score-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 18px;
            z-index: 20;
        }
        
        #altitude-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 18px;
            z-index: 20;
        }
        
        #altitude-indicator {
            position: absolute;
            right: 20px;
            top: 60px;
            width: 20px;
            height: 60%;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            z-index: 20;
            overflow: hidden;
        }
        
        #altitude-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #4CAF50, #8BC34A, #FFEB3B, #FF9800, #F44336);
            border-radius: 10px;
            transition: height 0.5s;
        }
        
        #moon-indicator {
            position: absolute;
            right: 20px;
            top: 30px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            z-index: 21;
        }
        
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
        
        #restart-button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            font-size: 14px;
            z-index: 20;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #start-screen h1 {
            color: white;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        #start-button {
            padding: 15px 30px;
            background-color: #4CAF50;
            border: none;
            color: white;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Level indicator */
        #level-indicator {
            position: absolute;
            top: 50px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 16px;
            z-index: 20;
            opacity: 0;
            transition: opacity 1s;
        }
        
        /* Animations */
        @keyframes movePlatform {
            0% { transform: translateX(0); }
            100% { transform: translateX(100px); }
        }
        
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }
        
        @keyframes blink {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        /* Particle effect */
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 15;
        }
        
        /* Media queries for different screen sizes */
        @media (max-width: 600px) {
            #score-display, #altitude-display {
                font-size: 14px;
                padding: 5px;
            }
            
            #level-indicator {
                font-size: 14px;
                padding: 5px;
            }
            
            #altitude-indicator {
                width: 15px;
                right: 10px;
            }
            
            #instructions {
                font-size: 12px;
            }
            
            #player {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Background layers -->
        <div id="sky-bg" class="bg-layer"></div>
        
        <!-- Celestial bodies -->
        <div id="sun"></div>
        <div id="moon"></div>
        
        <!-- Player character -->
        <img id="player" src="images/placeholder.png" alt="Player">
        
        <!-- Ground -->
        <div id="ground"></div>
        
        <!-- UI Elements -->
        <div id="score-display">Score: 0</div>
        <div id="altitude-display">Altitude: 0m</div>
        <div id="altitude-indicator">
            <div id="altitude-bar"></div>
        </div>
        <div id="moon-indicator"></div>
        <div id="level-indicator">Level: Ground</div>
        <div id="instructions">Tap left side to move left, right side to move right</div>
        
        <!-- Game over screen -->
        <div id="game-over">
            <h2>Game Over!</h2>
            <p>You reached: <span id="final-altitude">0</span> meters</p>
            <p>Final score: <span id="final-score">0</span></p>
            <button id="restart-button">Play Again</button>
        </div>
        
        <!-- Start screen -->
        <div id="start-screen">
            <h1>MOON JUMPER</h1>
            <p style="color: white; margin-bottom: 20px;">Jump as high as you can to reach the moon!</p>
            <button id="start-button">Start Game</button>
        </div>
    </div>
    
    <script>
        // Game variables
        let gameRunning = false;
        let playerX = window.innerWidth / 2;
        let playerY = window.innerHeight - 150;
        let playerVelocityY = 0;
        let playerVelocityX = 0;
        let gravity = 0.4;
        let jumpForce = -15;
        let isJumping = true;
        let score = 0;
        let altitude = 0;
        let maxAltitude = 0;
        let viewportOffset = 0;
        let platforms = [];
        let buildings = [];
        let trees = [];
        let clouds = [];
        let stars = [];
        let powerUps = [];
        let coins = [];
        let currentLevel = 0;
        let levelNames = ["Ground", "Sky", "Clouds", "Stratosphere", "Space"];
        let moonHeight = 50000; // Target altitude to reach the moon
        let hasJetpack = false;
        let jetpackTime = 0;
        let hasShield = false;
        let shieldTime = 0;
        
        // DOM elements
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const ground = document.getElementById('ground');
        const scoreDisplay = document.getElementById('score-display');
        const altitudeDisplay = document.getElementById('altitude-display');
        const altitudeBar = document.getElementById('altitude-bar');
        const gameOverScreen = document.getElementById('game-over');
        const finalAltitude = document.getElementById('final-altitude');
        const finalScore = document.getElementById('final-score');
        const restartButton = document.getElementById('restart-button');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const levelIndicator = document.getElementById('level-indicator');
        const skyBg = document.getElementById('sky-bg');
        const sun = document.getElementById('sun');
        const moon = document.getElementById('moon');
        
        // Platform settings
        const platformWidth = 70;
        const platformHeight = 15;
        const minPlatformGap = 60; // Minimum vertical gap between platforms
        const maxPlatformGap = 100; // Maximum vertical gap between platforms
        
        // Initialize the game
        function init() {
            // Reset game variables
            gameRunning = true;
            playerX = window.innerWidth / 2;
            playerY = window.innerHeight - 150;
            playerVelocityY = 0;
            playerVelocityX = 0;
            score = 0;
            altitude = 0;
            maxAltitude = 0;
            viewportOffset = 0;
            currentLevel = 0;
            platforms = [];
            buildings = [];
            trees = [];
            clouds = [];
            stars = [];
            powerUps = [];
            coins = [];
            hasJetpack = false;
            jetpackTime = 0;
            hasShield = false;
            shieldTime = 0;
            
            // Reset UI
            scoreDisplay.textContent = `Score: ${score}`;
            altitudeDisplay.textContent = `Altitude: ${altitude}m`;
            altitudeBar.style.height = '0%';
            
            // Create initial elements
            createStars();
            createInitialBuildings();
            createInitialTrees();
            createInitialPlatforms();
            createInitialClouds();
            
            // Set initial player position
            player.style.left = `${playerX}px`;
            player.style.bottom = `${playerY}px`;
            
            // Start game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Create initial buildings
        function createInitialBuildings() {
            for (let i = 0; i < 10; i++) {
                createBuilding(Math.random() * window.innerWidth);
            }
        }
        
        // Create a building
        function createBuilding(x) {
            const building = document.createElement('div');
            building.className = 'building';
            
            const height = 50 + Math.random() * 150;
            const width = 30 + Math.random() * 50;
            
            building.style.left = `${x}px`;
            building.style.width = `${width}px`;
            building.style.height = `${height}px`;
            
            gameContainer.appendChild(building);
            buildings.push({
                element: building,
                x: x,
                y: 0,
                width: width,
                height: height
            });
        }
        
        // Create initial trees
        function createInitialTrees() {
            for (let i = 0; i < 15; i++) {
                createTree(Math.random() * window.innerWidth);
            }
        }
        
        // Create a tree
        function createTree(x) {
            const tree = document.createElement('div');
            tree.className = 'tree';
            
            const trunk = document.createElement('div');
            trunk.className = 'tree-trunk';
            
            const top = document.createElement('div');
            top.className = 'tree-top';
            
            tree.appendChild(top);
            tree.appendChild(trunk);
            
            tree.style.left = `${x}px`;
            
            gameContainer.appendChild(tree);
            trees.push({
                element: tree,
                x: x,
                y: 0
            });
        }
        
        // Create initial platforms
        function createInitialPlatforms() {
            // Create ground platform
            const groundPlatform = {
                x: 0,
                y: 100,
                width: window.innerWidth,
                element: ground
            };
            platforms.push(groundPlatform);
            
            // Create platforms above ground
            for (let y = window.innerHeight - 200; y > -1000; y -= (minPlatformGap + Math.random() * (maxPlatformGap - minPlatformGap))) {
                createPlatform(y);
            }
        }
        
        // Create a platform
        function createPlatform(y, forceType = null) {
            const platform = document.createElement('div');
            platform.className = 'platform';
            
            // Random platform width
            const width = platformWidth * (0.7 + Math.random() * 0.6);
            
            // Random platform position
            const x = Math.random() * (window.innerWidth - width);
            
            platform.style.width = `${width}px`;
            platform.style.left = `${x}px`;
            platform.style.bottom = `${y}px`;
            
            // Platform types
            let type = forceType;
            if (!type) {
                const typeRoll = Math.random();
                if (y > 1000 && typeRoll < 0.1) {
                    type = 'moving';
                    platform.classList.add('moving');
                } else if (y > 2000 && typeRoll < 0.2) {
                    type = 'breakable';
                    platform.classList.add('breakable');
                } else if (y > 3000 && typeRoll < 0.3) {
                    type = 'bouncy';
                    platform.classList.add('bouncy');
                } else {
                    type = 'normal';
                }
            } else {
                platform.classList.add(forceType);
            }
            
            // Change platform color based on altitude
            if (y > 5000 && y <= 15000) {
                platform.style.backgroundColor = "#78909C"; // Mid-altitude color
            } else if (y > 15000) {
                platform.style.backgroundColor = "#E0E0E0"; // High-altitude color
            }
            
            gameContainer.appendChild(platform);
            
            // Add platform to array
            platforms.push({
                x: x,
                y: y,
                width: width,
                element: platform,
                type: type,
                active: true
            });
            
            // Sometimes add power-ups or coins above platforms
            if (y > 1000) {
                if (Math.random() < 0.05) {
                    createPowerUp(x + width / 2, y + 30);
                } else if (Math.random() < 0.2) {
                    createCoin(x + width / 2, y + 30);
                }
            }
            
            return platform;
        }
        
        // Create initial clouds
        function createInitialClouds() {
            for (let i = 0; i < 10; i++) {
                createCloud(
                    Math.random() * window.innerWidth,
                    500 + Math.random() * 4000
                );
            }
        }
        
        // Create a cloud
        function createCloud(x, y) {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            
            const size = 50 + Math.random() * 100;
            cloud.style.width = `${size}px`;
            cloud.style.height = `${size / 2}px`;
            cloud.style.left = `${x}px`;
            cloud.style.bottom = `${y}px`;
            
            gameContainer.appendChild(cloud);
            clouds.push({
                element: cloud,
                x: x,
                y: y,
                size: size
            });
        }
        
        // Create stars
        function createStars() {
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const x = Math.random() * window.innerWidth;
                const y = 10000 + Math.random() * 40000;
                
                star.style.left = `${x}px`;
                star.style.bottom = `${y}px`;
                
                if (Math.random() < 0.2) {
                    star.style.width = '3px';
                    star.style.height = '3px';
                    star.style.boxShadow = '0 0 3px 1px white';
                }
                
                if (Math.random() < 0.1) {
                    star.style.animation = `blink ${2 + Math.random() * 3}s infinite`;
                }
                
                gameContainer.appendChild(star);
                stars.push({
                    element: star,
                    x: x,
                    y: y
                });
            }
        }
        
        // Create a power-up
        function createPowerUp(x, y) {
            const powerUp = document.createElement('div');
            powerUp.className = 'power-up';
            
            let type;
            if (Math.random() < 0.5) {
                type = 'jetpack';
                powerUp.classList.add('jetpack');
            } else {
                type = 'shield';
                powerUp.classList.add('shield');
            }
            
            powerUp.style.left = `${x}px`;
            powerUp.style.bottom = `${y}px`;
            
            gameContainer.appendChild(powerUp);
            powerUps.push({
                element: powerUp,
                x: x,
                y: y,
                type: type
            });
        }
        
        // Create a coin
        function createCoin(x, y) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            coin.style.left = `${x}px`;
            coin.style.bottom = `${y}px`;
            
            gameContainer.appendChild(coin);
            coins.push({
                element: coin,
                x: x,
                y: y
            });
        }
        
        // Create particles
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${x}px`;
                particle.style.bottom = `${y}px`;
                particle.style.backgroundColor = color;
                
                const size = 2 + Math.random() * 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                const angle = Math.random() * Math.PI * 2;
                const speed = 1 + Math.random() * 3;
                const velocityX = Math.cos(angle) * speed;
                const velocityY = Math.sin(angle) * speed;
                
                gameContainer.appendChild(particle);
                
                let opacity = 1;
                const animateParticle = () => {
                    if (opacity <= 0) {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                        return;
                    }
                    
                    const currentX = parseFloat(particle.style.left);
                    const currentY = parseFloat(particle.style.bottom);
                    
                    particle.style.left = `${currentX + velocityX}px`;
                    particle.style.bottom = `${currentY + velocityY}px`;
                    
                    opacity -= 0.02;
                    particle.style.opacity = opacity;
                    
                    requestAnimationFrame(animateParticle);
                };
                
                requestAnimationFrame(animateParticle);
            }
        }
        
        // Check if player is on a platform
        function isOnPlatform() {
            if (playerVelocityY > 0) return false; // Rising, not on platform
            
            for (let i = 0; i < platforms.length; i++) {
                const platform = platforms[i];
                
                // Skip inactive platforms
                if (platform.type === 'breakable' && !platform.active) continue;
                
                // Check collision
                if (
                    playerX >= platform.x && 
                    playerX <= platform.x + platform.width &&
                    playerY <= platform.y + platformHeight + 5 &&
                    playerY >= platform.y - 5
                ) {
                    // Special platform effects
                    if (platform.type === 'breakable') {
                        breakPlatform(platform);
                        return false; // Falls through
                    } else if (platform.type === 'bouncy') {
                        jumpForce = -20; // Extra bounce
                        createParticles(playerX, playerY, 10, '#AED581');
                    } else {
                        jumpForce = -15; // Normal jump
                    }
                    
                    return platform;
                }
            }
            
            return false;
        }
        
        // Break a platform
        function breakPlatform(platform) {
            platform.active = false;
            platform.element.style.opacity = '0.5';
            createParticles(platform.x + platform.width / 2, platform.y, 15, '#FFAB91');
            
            setTimeout(() => {
                if (platform.element.parentNode) {
                    platform.element.parentNode.removeChild(platform.element);
                }
                platforms = platforms.filter(p => p !== platform);
            }, 300);
        }
        
        // Check collision with power-ups
        function checkPowerUpCollision() {
            for (let i = 0; i < powerUps.length; i++) {
                const powerUp = powerUps[i];
                
                if (
                    Math.abs(playerX - powerUp.x) < 30 &&
                    Math.abs(playerY - powerUp.y) < 30
                ) {
                    // Collect power-up
                    if (powerUp.element.parentNode) {
                        powerUp.element.parentNode.removeChild(powerUp.element);
                    }
                    
                    // Apply power-up effect
                    if (powerUp.type === 'jetpack') {
                        hasJetpack = true;
                        jetpackTime = 300; // Frames of jetpack time (5 seconds at 60fps)
                        createParticles(playerX, playerY - 20, 20, '#FF9800');
                        score += 30;
                    } else if (powerUp.type === 'shield') {
                        hasShield = true;
                        shieldTime = 600; // 10 seconds
                        createParticles(playerX, playerY, 20, '#2196F3');
                        score += 20;
                    }
                    
                    // Remove from array
                    powerUps.splice(i, 1);
                    i--;
                    
                    // Update score
                    scoreDisplay.textContent = `Score: ${score}`;
                }
            }
        }
        
        // Check collision with coins
        function checkCoinCollision() {
            for (let i = 0; i < coins.length; i++) {
                const coin = coins[i];
                
                if (
                    Math.abs(playerX - coin.x) < 25 &&
                    Math.abs(playerY - coin.y) < 25
                ) {
                    // Collect coin
                    if (coin.element.parentNode) {
                        coin.element.parentNode.removeChild(coin.element);
                    }
                    
                    // Create particle effect
                    createParticles(coin.x, coin.y, 10, '#FFD600');
                    
                    // Add score
                    score += 10;
                    scoreDisplay.textContent = `Score: ${score}`;
                    
                    // Remove from array
                    coins.splice(i, 1);
                    i--;
                }
            }
        }
        
        // Update platform positions (for moving platforms)
        function updatePlatforms() {
            for (let i = 0; i < platforms.length; i++) {
                const platform = platforms[i];
                
                if (platform.type === 'moving') {
                    // Get current transform
                    const transform = window.getComputedStyle(platform.element).getPropertyValue('transform');
                    if (transform && transform !== 'none') {
                        const matrix = new DOMMatrix(transform);
                        platform.x = parseFloat(platform.element.style.left) + matrix.m41;
                    }
                }
            }
        }
        
        // Generate new content as player ascends
        function generateContent() {
            const visibleTop = viewportOffset + window.innerHeight;
            const highestPlatform = Math.max(...platforms.map(p => p.y));
            
            // Create new platforms
            if (highestPlatform < visibleTop + 1000) {
                for (let y = highestPlatform + minPlatformGap; y < visibleTop + 2000; y += (minPlatformGap + Math.random() * (maxPlatformGap - minPlatformGap))) {
                    createPlatform(y);
                }
            }
            
            // Create new clouds
            if (altitude > 500 && clouds.length < 20 && Math.random() < 0.02) {
                createCloud(
                    Math.random() * window.innerWidth,
                    viewportOffset + window.innerHeight + Math.random() * 500
                );
            }
        }
        
        // Update game level based on altitude
        function updateLevel() {
            let newLevel = 0;
            
            if (altitude > 1000 && altitude <= 5000) {
                newLevel = 1; // Sky
            } else if (altitude > 5000 && altitude <= 15000) {
                newLevel = 2; // Clouds
            } else if (altitude > 15000 && altitude <= 30000) {
                newLevel = 3; // Stratosphere
            } else if (altitude > 30000) {
                newLevel = 4; // Space
            }
            
            if (newLevel !== currentLevel) {
                currentLevel = newLevel;
                levelIndicator.textContent = `Level: ${levelNames[currentLevel]}`;
                levelIndicator.style.opacity = '1';
                
                // Fade out level indicator after 3 seconds
                setTimeout(() => {
                    levelIndicator.style.opacity = '0';
                }, 3000);
                
                // Visual changes based on level
                switch (currentLevel) {
                    case 1: // Sky
                        // Already default sky color
                        break;
                    case 2: // Clouds
                        // More blue sky
                        break;
                    case 3: // Stratosphere
                        // Start showing stars
                        stars.forEach(star => {
                            if (star.y <= altitude + 2000) {
                                star.element.style.opacity = '1';
                            }
                        });
                        break;
                    case 4: // Space
                        // All stars visible, darker sky
                        stars.forEach(star => {
                            star.element.style.opacity = '1';
                        });
                        break;
                }
            }
            
            // Show stars as player ascends
            if (altitude > 10000) {
                stars.forEach(star => {
                    if (star.y <= altitude + 2000) {
                        star.element.style.opacity = '1';
                    }
                });
            }
            
            // Update progress bar
            const progress = Math.min((altitude / moonHeight) * 100, 100);
            altitudeBar.style.height = `${progress}%`;
            
            // Move sun and moon
            if (altitude > 1000) {
                const sunY = 50 - (altitude / 500);
                sun.style.top = `${Math.max(sunY, -100)}px`;
                
                if (altitude > 30000) {
                    // Start showing the moon
                    const moonY = -120 + ((altitude - 30000) / 200);
                    moon.style.top = `${Math.min(moonY, 50)}px`;
                }
            }
            
            // Change background gradient based on altitude
            if (altitude < 10000) {
                // Sky to darker sky
                const blueRatio = Math.min(altitude / 10000, 1);
                skyBg.style.background = `linear-gradient(to top, 
                    var(--sky-color-1) ${10 - blueRatio * 10}%, 
                    var(--sky-color-2) ${60 - blueRatio * 20}%, 
                    var(--space-color) ${85 - blueRatio * 15}%)`;
            } else if (altitude >= 10000 && altitude < 30000) {
                // Darker sky to space
                const spaceRatio = Math.min((altitude - 10000) / 20000, 1);
                skyBg.style.background = `linear-gradient(to top, 
                    var(--sky-color-2) ${10 - spaceRatio * 10}%, 
                    var(--space-color) ${60 - spaceRatio * 30}%)`;
            } else {
                // Full space background
                skyBg.style.backgroundColor = 'var(--space-color)';
            }
        }
        
        // Game over function
        function gameOver() {
            gameRunning = false;
            finalAltitude.textContent = Math.floor(maxAltitude);
            finalScore.textContent = score;
            gameOverScreen.style.display = 'block';
            
            // Create explosion effect
            createParticles(playerX, playerY, 30, '#F44336');
        }
        
        // Game loop
        function gameLoop() {
            if (!gameRunning) return;
            
            // Apply gravity or jetpack
            if (hasJetpack && jetpackTime > 0) {
                playerVelocityY = -5; // Constant upward force
                jetpackTime--;
                
                // Jetpack particles
                if (gameLoop.frame % 2 === 0) {
                    createParticles(playerX, playerY - 20, 2, '#FF9800');
                }
                
                // End jetpack
                if (jetpackTime <= 0) {
                    hasJetpack = false;
                }
            } else {
                playerVelocityY += gravity;
            }
            
            // Shield countdown
            if (hasShield && shieldTime > 0) {
                shieldTime--;
                // End shield
                if (shieldTime <= 0) {
                    hasShield = false;
                }
            }
            
            // Update player position
            playerY -= playerVelocityY;
            playerX += playerVelocityX;
            
            // Screen boundaries
            if (playerX < 0) playerX = 0;
            if (playerX > window.innerWidth) playerX = window.innerWidth;
            
            // Check if player is on a platform
            const platform = isOnPlatform();
            if (platform && playerVelocityY >= 0) {
                playerY = platform.y + platformHeight;
                playerVelocityY = jumpForce;
                isJumping = true;
            }
            
            // Check power-up collision
            checkPowerUpCollision();
            
            // Check coin collision
            checkCoinCollision();
            
            // Update moving platforms
            updatePlatforms();
            
            // Calculate altitude (highest point reached)
            altitude = playerY;
            maxAltitude = Math.max(maxAltitude, altitude);
            
            // Update altitude display
            altitudeDisplay.textContent = `Altitude: ${Math.floor(altitude)}m`;
            
            // Generate new content
            generateContent();
            
            // Update level
            updateLevel();
            
            // Check if player fell off screen
            if (playerY < viewportOffset - 100 && !hasShield) {
                gameOver();
                return;
            }
            
            // Check if player reached the moon (win condition)
            if (altitude >= moonHeight) {
                // Win game
                gameRunning = false;
                finalAltitude.textContent = Math.floor(maxAltitude);
                finalScore.textContent = score + 1000; // Bonus for reaching the moon
                document.querySelector('#game-over h2').textContent = 'You Reached the Moon!';
                gameOverScreen.style.display = 'block';
                return;
            }
            
            // Scroll view to follow player (with some leeway)
            const idealOffset = playerY - window.innerHeight / 3;
            if (idealOffset > viewportOffset) {
                viewportOffset += (idealOffset - viewportOffset) * 0.1;
                
                // Update elements relative to viewport
                gameContainer.style.transform = `translateY(${-viewportOffset}px)`;
            }
            
            // Update player position
            player.style.left = `${playerX}px`;
            player.style.bottom = `${playerY}px`;
            
            // Visual effects for player
            if (hasJetpack) {
                player.style.filter = 'drop-shadow(0 0 10px #FF9800)';
            } else if (hasShield) {
                player.style.filter = 'drop-shadow(0 0 10px #2196F3)';
            } else {
                player.style.filter = 'none';
            }
            
            // Continue game loop
            gameLoop.frame = (gameLoop.frame || 0) + 1;
            requestAnimationFrame(gameLoop);
        }
        
        // Handle touch input
        function handleTouchMove(e) {
            e.preventDefault();
            
            // Get touch position
            const touch = e.touches[0];
            const touchX = touch.clientX;
            
            // Move player based on which side of screen is touched
            if (touchX < window.innerWidth / 2) {
                // Move left
                playerVelocityX = -4;
                player.style.transform = 'translateX(-50%) scaleX(-1)'; // Flip sprite
            } else {
                // Move right
                playerVelocityX = 4;
                player.style.transform = 'translateX(-50%) scaleX(1)'; // Normal sprite
            }
        }
        
        function handleTouchEnd() {
            // Stop moving
            playerVelocityX = 0;
        }
        
        // Handle keyboard input (for testing on desktop)
        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft') {
                playerVelocityX = -4;
                player.style.transform = 'translateX(-50%) scaleX(-1)'; // Flip sprite
            } else if (e.key === 'ArrowRight') {
                playerVelocityX = 4;
                player.style.transform = 'translateX(-50%) scaleX(1)'; // Normal sprite
            }
        }
        
        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                playerVelocityX = 0;
            }
        }
        
        // Event listeners
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd);
        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            init();
        });
        
        // Start button
        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            init();
        });
    </script>
</body>
</html>
